<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>편의점 계산기</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px; }
        h1 { text-align: center; }
        .item-list { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; }
        .item-row { display: flex; align-items: center; margin-bottom: 10px; }
        .item-row input { margin-left: 10px; width: 60px; }
        #total, #change { font-size: 1.5em; font-weight: bold; margin-top: 10px; }
        button { padding: 10px 20px; }

        /* 판매 기록 스타일 */
        .sales-record-item { border: 1px solid #ddd; margin-bottom: 10px; }
        .sales-record-summary { display: flex; justify-content: space-between; align-items: center; padding: 10px; cursor: pointer; background-color: #f9f9f9; }
        .sales-record-details { padding: 10px; border-top: 1px solid #ddd; display: none; }
        .delete-button { background-color: #f44336; color: white; border: none; padding: 5px 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>편의점 계산기</h1>
    
    <h2>판매 목록</h2>
    <div class="item-list">
        <div class="item-row">
            <span>물품 1: </span>
            <input type="number" id="item1-price" value="1500" hidden>
            <input type="number" id="item1-quantity" value="0" min="0"> 개
            <span> (1500원)</span>
        </div>
        <div class="item-row">
            <span>물품 2: </span>
            <input type="number" id="item2-price" value="1200" hidden>
            <input type="number" id="item2-quantity" value="0" min="0"> 개
            <span> (1200원)</span>
        </div>
        <div class="item-row">
            <span>물품 3: </span>
            <input type="number" id="item3-price" value="2500" hidden>
            <input type="number" id="item3-quantity" value="0" min="0"> 개
            <span> (2500원)</span>
        </div>
    </div>

    <p>총 합계: <span id="total">0</span> 원</p>
    
    <div>
        <label for="received-amount">받은 금액:</label>
        <input type="number" id="received-amount" min="0"> 원
    </div>
    
    <p>거스름돈: <span id="change">0</span> 원</p>
    
    <button id="save-button">저장</button>

    <hr>
    <h2>판매 기록</h2>
    <div id="sales-history">
        </div>

    <script>
        // 물품 정보 (나중에 재고 관리와 연동될 예정)
        const allItems = [
            { name: '물품 1', id: 'item1', price: 1500 },
            { name: '물품 2', id: 'item2', price: 1200 },
            { name: '물품 3', id: 'item3', price: 2500 }
        ];

        // 물품 수량이 바뀌면 총 합계를 계산하는 함수
        function calculateTotal() {
            let total = 0;
            allItems.forEach(item => {
                const quantity = parseInt(document.getElementById(`${item.id}-quantity`).value) || 0;
                total += item.price * quantity;
            });
            document.getElementById('total').innerText = total;
            calculateChange();
        }

        // 받은 금액이 바뀌면 거스름돈을 계산하는 함수
        function calculateChange() {
            const total = parseInt(document.getElementById('total').innerText);
            const received = parseInt(document.getElementById('received-amount').value) || 0;
            const change = received - total;
            document.getElementById('change').innerText = Math.max(0, change);
        }

        // 판매 기록을 localStorage에 저장하는 함수
        function saveHistoryToLocalStorage() {
            const history = document.getElementById('sales-history').innerHTML;
            localStorage.setItem('salesHistory', history);
        }

        // 페이지 로딩 시 localStorage에서 기록을 불러오는 함수
        function loadHistoryFromLocalStorage() {
            const savedHistory = localStorage.getItem('salesHistory');
            if (savedHistory) {
                document.getElementById('sales-history').innerHTML = savedHistory;
            }
        }
        
        // 판매 기록을 삭제하는 함수
        function deleteSale(event) {
            const recordItem = event.target.closest('.sales-record-item');
            recordItem.remove();
            saveHistoryToLocalStorage();
        }

        // 판매 기록을 페이지에 렌더링하고 이벤트 리스너를 추가하는 함수
        function renderSaleRecord(saleRecordHTML) {
            const salesHistory = document.getElementById('sales-history');
            salesHistory.innerHTML = saleRecordHTML + salesHistory.innerHTML;

            const newRecord = salesHistory.firstElementChild;
            const summary = newRecord.querySelector('.sales-record-summary');
            const details = newRecord.querySelector('.sales-record-details');
            const deleteButton = newRecord.querySelector('.delete-button');

            summary.addEventListener('click', () => {
                details.style.display = (details.style.display === 'none' || details.style.display === '') ? 'block' : 'none';
            });
            deleteButton.addEventListener('click', deleteSale);
            saveHistoryToLocalStorage();
        }

        // 저장 버튼 클릭 시 판매 기록을 페이지에 남기는 함수
        function saveSale() {
            const now = new Date();
            const time = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            
            let saleDetails = '<ul>';
            allItems.forEach(item => {
                const quantity = parseInt(document.getElementById(`${item.id}-quantity`).value);
                if (quantity > 0) {
                    saleDetails += `<li>${item.name}: ${quantity}개 (${item.price * quantity}원)</li>`;
                }
            });
            saleDetails += '</ul>';
            
            const total = document.getElementById('total').innerText;
            const received = document.getElementById('received-amount').value;
            const change = document.getElementById('change').innerText;

            const saleRecordHTML = `
                <div class="sales-record-item">
                    <div class="sales-record-summary">
                        <span>${time} - 총 금액: ${total}원</span>
                        <div>
                            <button class="delete-button">삭제</button>
                            <span>▼</span>
                        </div>
                    </div>
                    <div class="sales-record-details">
                        <p><strong>받은 금액:</strong> ${received}원</p>
                        <p><strong>거스름돈:</strong> ${change}원</p>
                        <p><strong>판매 목록:</strong></p>
                        ${saleDetails}
                    </div>
                </div>
            `;
            
            renderSaleRecord(saleRecordHTML);

            // 입력창 초기화
            allItems.forEach(item => {
                document.getElementById(`${item.id}-quantity`).value = 0;
            });
            document.getElementById('received-amount').value = '';
            calculateTotal();
            alert('판매 기록이 저장되었습니다!');
        }

        // 이벤트 리스너 설정
        document.getElementById('item1-quantity').addEventListener('input', calculateTotal);
        document.getElementById('item2-quantity').addEventListener('input', calculateTotal);
        document.getElementById('item3-quantity').addEventListener('input', calculateTotal);
        document.getElementById('received-amount').addEventListener('input', calculateChange);
        document.getElementById('save-button').addEventListener('click', saveSale);

        // 페이지 로딩 시 기록 불러오기
        window.addEventListener('DOMContentLoaded', loadHistoryFromLocalStorage);
    </script>
</body>
</html>
