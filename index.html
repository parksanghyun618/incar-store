<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>인카마트 포스기</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px; }
        h1 { text-align: center; }
        .item-list { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; }
        .item-row { display: flex; align-items: center; margin-bottom: 10px; }
        .item-row input { margin-left: 10px; width: 60px; }
        #total, #change, #total-revenue { font-size: 1.5em; font-weight: bold; margin-top: 10px; }
        button { padding: 10px 20px; }

        /* 판매 기록 스타일 */
        .sales-record-item { border: 1px solid #ddd; margin-bottom: 10px; }
        .sales-record-summary { display: flex; justify-content: space-between; align-items: center; padding: 10px; cursor: pointer; background-color: #f9f9f9; }
        .sales-record-details { padding: 10px; border-top: 1px solid #ddd; display: none; }
        .delete-button { background-color: #f44336; color: white; border: none; padding: 5px 10px; cursor: pointer; }
        .pagination { text-align: center; margin-top: 20px; }
        .pagination button { margin: 0 5px; cursor: pointer; padding: 5px 10px; }
        .pagination button.active { background-color: #007bff; color: white; border: 1px solid #007bff; }
    </style>
</head>
<body>
    <h1>인카마트 포스기</h1>
    <p><a href="stock.html">재고 관리 페이지로 이동</a></p>
    
    <h2>판매 목록</h2>
    <div class="item-list">
        <div class="item-row">
            <span>물품 1: </span>
            <input type="number" id="item1-price" value="1500" hidden>
            <input type="number" id="item1-quantity" value="" min="0"> 개
            <span class="stock-info" id="item1-stock"></span>
            <span> (1500원)</span>
        </div>
        <div class="item-row">
            <span>물품 2: </span>
            <input type="number" id="item2-price" value="1200" hidden>
            <input type="number" id="item2-quantity" value="" min="0"> 개
            <span class="stock-info" id="item2-stock"></span>
            <span> (1200원)</span>
        </div>
        <div class="item-row">
            <span>물품 3: </span>
            <input type="number" id="item3-price" value="2500" hidden>
            <input type="number" id="item3-quantity" value="" min="0"> 개
            <span class="stock-info" id="item3-stock"></span>
            <span> (2500원)</span>
        </div>
    </div>

    <p>총 합계: <span id="total">0</span> 원</p>
    
    <div>
        <label for="received-amount">받은 금액:</label>
        <input type="number" id="received-amount" min="0"> 원
    </div>
    
    <p>거스름돈: <span id="change">0</span> 원</p>
    
    <button id="save-button">저장</button>

    <hr>
    <h2>판매 기록</h2>
    <div id="sales-history">
        </div>
    <div id="pagination-container" class="pagination">
        </div>
    <p>총 매출액: <span id="total-revenue">0</span> 원</p>


    <script>
        const allItems = [
            { name: '물품 1', id: 'item1', price: 1500 },
            { name: '물품 2', id: 'item2', price: 1200 },
            { name: '물품 3', id: 'item3', price: 2500 }
        ];

        let currentPage = 1;
        const recordsPerPage = 10;
        let previousDate = null;

        function loadStock() {
            const savedStock = localStorage.getItem('stockLevels');
            if (savedStock) {
                const stock = JSON.parse(savedStock);
                allItems.forEach(item => {
                    const stockSpan = document.getElementById(`${item.id}-stock`);
                    if (stockSpan) {
                        stockSpan.innerText = `(재고: ${stock[item.id]})`;
                    }
                });
            } else {
                const initialStock = { item1: 50, item2: 30, item3: 10 };
                localStorage.setItem('stockLevels', JSON.stringify(initialStock));
                loadStock();
            }
        }
        
        function calculateTotal() {
            let total = 0;
            allItems.forEach(item => {
                const quantity = parseInt(document.getElementById(`${item.id}-quantity`).value) || 0;
                total += item.price * quantity;
            });
            document.getElementById('total').innerText = total;
            calculateChange();
        }

        function calculateChange() {
            const total = parseInt(document.getElementById('total').innerText);
            const received = parseInt(document.getElementById('received-amount').value) || 0;
            const change = received - total;
            document.getElementById('change').innerText = Math.max(0, change);
        }

        function calculateTotalRevenue() {
            let totalRevenue = 0;
            let salesHistory = JSON.parse(localStorage.getItem('salesHistory')) || [];
            salesHistory.forEach(record => {
                totalRevenue += parseInt(record.total);
            });
            document.getElementById('total-revenue').innerText = totalRevenue;
        }

        function saveHistoryToLocalStorage(history) {
            localStorage.setItem('salesHistory', JSON.stringify(history));
        }

        function deleteSale(event) {
            const recordItem = event.target.closest('.sales-record-item');
            const index = parseInt(recordItem.dataset.index);
            
            let salesHistory = JSON.parse(localStorage.getItem('salesHistory')) || [];
            const deletedRecord = salesHistory[index];

            const savedStock = JSON.parse(localStorage.getItem('stockLevels'));
            for (const itemId in deletedRecord.items) {
                savedStock[itemId] += deletedRecord.items[itemId];
            }
            localStorage.setItem('stockLevels', JSON.stringify(savedStock));
            loadStock();
            
            salesHistory.splice(index, 1);
            saveHistoryToLocalStorage(salesHistory);
            renderSalesHistory();
            calculateTotalRevenue();
        }
        
        function renderSalesHistory() {
            const salesHistoryDiv = document.getElementById('sales-history');
            const paginationDiv = document.getElementById('pagination-container');
            salesHistoryDiv.innerHTML = '';
            paginationDiv.innerHTML = '';
            
            previousDate = null;

            let salesHistory = JSON.parse(localStorage.getItem('salesHistory')) || [];
            const totalPages = Math.ceil(salesHistory.length / recordsPerPage);

            const start = (currentPage - 1) * recordsPerPage;
            const end = start + recordsPerPage;
            const recordsToDisplay = salesHistory.slice(start, end);

            recordsToDisplay.forEach((record, index) => {
                const globalIndex = start + index;
                let saleDetailsHtml = '<ul>';
                for (const itemId in record.items) {
                    const item = allItems.find(i => i.id === itemId);
                    saleDetailsHtml += `<li>${item.name}: ${record.items[itemId]}개 (${item.price * record.items[itemId]}원)</li>`;
                }
                saleDetailsHtml += '</ul>';

                let displayDate = '';
                if (record.date !== previousDate) {
                    displayDate = record.date;
                    previousDate = record.date;
                }

                const saleRecordHtml = `
                    <div class="sales-record-item" data-index="${globalIndex}">
                        <div class="sales-record-summary">
                            <span>${displayDate}&nbsp;&nbsp;${record.time} - 총 금액: ${record.total}원</span>
                            <div>
                                <button class="delete-button">삭제</button>
                                <span>▼</span>
                            </div>
                        </div>
                        <div class="sales-record-details">
                            <p><strong>받은 금액:</strong> ${record.received}원</p>
                            <p><strong>거스름돈:</strong> ${record.change}원</p>
                            <p><strong>판매 목록:</strong></p>
                            ${saleDetailsHtml}
                        </div>
                    </div>
                `;
                salesHistoryDiv.innerHTML += saleRecordHtml;
            });
            
            document.querySelectorAll('.sales-record-item').forEach(record => {
                const summary = record.querySelector('.sales-record-summary');
                const details = record.querySelector('.sales-record-details');
                const deleteButton = record.querySelector('.delete-button');

                summary.addEventListener('click', () => {
                    details.style.display = (details.style.display === 'none' || details.style.display === '') ? 'block' : 'none';
                });
                deleteButton.addEventListener('click', deleteSale);
            });

            if (totalPages > 1) {
                for (let i = 1; i <= totalPages; i++) {
                    const pageButton = document.createElement('button');
                    pageButton.innerText = i;
                    if (i === currentPage) {
                        pageButton.classList.add('active');
                    }
                    pageButton.addEventListener('click', () => {
                        currentPage = i;
                        renderSalesHistory();
                    });
                    paginationDiv.appendChild(pageButton);
                }
            }
        }
        
        function saveSale() {
            const now = new Date();
            const date = `${now.getFullYear().toString().slice(-2)}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;
            const time = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            
            const savedStock = JSON.parse(localStorage.getItem('stockLevels')) || {};
            let saleItemsData = {};
            
            let noItemsSelected = true;
            allItems.forEach(item => {
                const quantity = parseInt(document.getElementById(`${item.id}-quantity`).value);
                if (quantity > 0) {
                    savedStock[item.id] -= quantity;
                    saleItemsData[item.id] = quantity;
                    noItemsSelected = false;
                }
            });

            if (noItemsSelected) {
                alert('판매할 물품을 선택해주세요!');
                return;
            }

            localStorage.setItem('stockLevels', JSON.stringify(savedStock));
            loadStock();
            
            const total = parseInt(document.getElementById('total').innerText);
            let received = parseInt(document.getElementById('received-amount').value);

            if (isNaN(received)) {
                received = total;
            }
            const change = received - total;
            
            const newRecord = {
                date: date,
                time: time,
                total: total,
                received: received,
                change: change,
                items: saleItemsData
            };
            
            let salesHistory = JSON.parse(localStorage.getItem('salesHistory')) || [];
            salesHistory.unshift(newRecord);
            
            saveHistoryToLocalStorage(salesHistory);
            renderSalesHistory();
            calculateTotalRevenue();

            allItems.forEach(item => {
                document.getElementById(`${item.id}-quantity`).value = '';
            });
            document.getElementById('received-amount').value = '';
            calculateTotal();
            alert('판매 기록이 저장되었습니다!');
        }
        
        document.getElementById('received-amount').addEventListener('keydown', function(event) {
            if (event.key === 'Enter' || event.keyCode === 13) {
                saveSale();
            }
        });

        document.getElementById('item1-quantity').addEventListener('input', calculateTotal);
        document.getElementById('item2-quantity').addEventListener('input', calculateTotal);
        document.getElementById('item3-quantity').addEventListener('input', calculateTotal);
        document.getElementById('received-amount').addEventListener('input', calculateChange);
        document.getElementById('save-button').addEventListener('click', saveSale);

        window.addEventListener('DOMContentLoaded', () => {
            renderSalesHistory();
            loadStock();
            calculateTotalRevenue();
        });
    </script>
</body>
</html>
